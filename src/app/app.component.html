<div class="sr-only" id="sort-filter-desc">
	This filtering area contains options for sorting data dynamically for easy discovery.
	Filtering options include search by text, dropdowns for filtering based on various fields, and various sorting.
</div>
<div class="card mb-3 {{formBgColor}}" aria-describedby="sort-filter-desc">
	<div class="card-body">
		<form class="forms" #filtersubmit="ngForm" (ngSubmit)="updateFilter(filtersubmit.value)">
			<div class="row">
				<div class="col-md-6 mb-3">
					<label for="Search" class="forms-label h5 open">Search</label>
					<input *ngIf="!submitButton" [(ngModel)]="searchValue"
						   class="form-control nobutton" type="text" id="Search"
						   name="Search" placeholder="Enter keywords"/>
					<input *ngIf="submitButton" [(ngModel)]="searchValue" class="form-control button" type="text" id="Search"
						   name="Search" placeholder="Enter keywords"/>
				</div>
				<div *ngFor="let filter of filterFields" class="col-md-6 mb-3">
                    <label for="filter-{{filter}}" class="forms-label h5 open">Filter by {{filter}}</label>
                    <div class="dropdown" id="filter-{{filter}}">
                        <button class="btn dropdown-toggle form-control text-left td-none" id="button-{{filter.toLowerCase().replace(' ','-')}}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select {{filter}}
                        </button>
                        <div class="dropdown-menu" [attr.aria-labelledby]="'button-'+filter">
                            <a href="#" [attr.class]="(filterModel[filter] == '') ? 'dropdown-item selected' : 'dropdown-item'" (click)="filterModel[filter] = '';" (keyup)="selectFilter($event, filter, [])">Select {{filter}}</a>
                            <a href="#" [attr.class]="(filterModel[filter] == vals.raw) ? 'dropdown-item selected ' + vals.class : 'dropdown-item '+ vals.class" *ngFor="let vals of dataHouse.filters[filter]" (click)="filterModel[filter] = vals.raw;" (keyup)="selectFilter($event, filter, vals)">{{vals.title}}</a>
                        </div>
                    </div>
                    <input type="hidden" name="filter-{{filter}}" class="form-control" [(ngModel)]="filterModel[filter]">
				</div>
				<div *ngIf="0 === filterFields.length % 2" class="col-md-6 mb-3 order-1 order-md-2">
                    <label *ngIf="sortOptions && sortOptions.length" for="Sort" class="forms-label h5 open">Sort</label>
                    <div class="dropdown" *ngIf="sortOptions && sortOptions.length">
                        <button class="btn dropdown-toggle form-control text-left td-none" id="Sort" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {{sortLabel}}
                        </button>
                        <div class="dropdown-menu" aria-labelledby="Sort">
                            <a class="dropdown-item" href="#" *ngFor="let sortOption of sortOptions" (click)="updateSorts(sortOption.value,sortOption.label)">{{sortOption.label}}</a>
                        </div>
                    </div>
                    <input type="hidden" name="Sort" class="form-control" [(ngModel)]="sortValue">
				</div>
			</div>
			<div class="row">
				<!-- Submit / Reset Buttons -->
				<div class="col-md-6 mt-md-4 order-2 order-md-1">
					<button type="reset" *ngIf="resetButton" class="btn btn-sm {{resetButtonColor}} mr-3" (click)="clearFilter()">
						Reset
					</button>
					<button *ngIf="submitButton" type="submit" class="btn btn-sm {{submitButtonColor}}">
						Submit
					</button>
				</div>
				<div *ngIf="0 !== filterFields.length % 2" class="col-md-6 mb-3 order-1 order-md-2">
                    <label for="Sort" class="forms-label h5 open">Sort</label>
                    <div class="dropdown">
                        <button class="btn dropdown-toggle form-control text-left td-none" id="Sort" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {{sortLabel}}
                        </button>
                        <div class="dropdown-menu" aria-labelledby="Sort">
                            <a class="dropdown-item" href="#" *ngFor="let sortOption of sortOptions" (click)="updateSorts(sortOption.value,sortOption.label)">{{sortOption.label}}</a>
                        </div>
                    </div>
                    <input type="hidden" name="Sort" class="form-control" [(ngModel)]="sortValue">
				</div>
			</div>
		</form>
	</div>
</div>
<div role="alert" id="resultCount" tabindex="-1" *ngIf="searched">
    <p [attr.class]="errorMsg ? 'd-block' : 'd-none'">
        {{errorMsg}}
    </p>
	<p [attr.class]="filteredDataLength <= 0 ? 'd-block' : 'd-none'">
		No results available for the selected criteria. Please adjust the filter options above.
	</p>
	<p [attr.class]="filteredDataLength > 0 && filteredDataLength < dataHouse.items.length ? 'd-block' : 'd-none'">
		<span class="sr-only">Search results </span>Found {{filteredDataLength}} items out of {{dataHouse.items.length}} total items.
	</p>
</div>
<div *ngIf="errorMsg">
    <p>{{errorMsg}}</p>
</div>
<div>
  <!-- RESULTS with card position left, right or not set -->
	<div *ngIf="!imagePosition || 'left' === imagePosition || 'right' === imagePosition">
		<div class="row">
			<div class="{{colWidth}}" *ngFor="let item of currentPageData; let i = index; let odd = odd">
				<div class="card mb-3 {{bgColor}}">
					<div class="card-body">
						<div class="row">
							<ng-container *ngIf="'left' === imagePosition">
								<div *ngIf="item[imageField]" class="{{imageColWidth}}">
									<img *ngIf="!makeImagesLinks" src="{{item[imageField]}}" alt="{{item.hasOwnProperty( imageField + '_alt' ) ? item[imageField + '_alt'] : item[titleField]}}" class="img-fluid"/>
									<a *ngIf="makeImagesLinks" href="{{item[urlField]}}" [attr.target]="isLinkExternal(item[urlField]) ? '_blank' : null">
										<img src="{{item[imageField]}}" alt="{{item.hasOwnProperty( imageField + '_alt' ) ? item[imageField + '_alt'] : item[titleField]}}" class="img-fluid"/>
									</a>
								</div>
							</ng-container>
							<div class="{{textColWidth}}">
								<div *ngIf="item[titleField]" class="card-title h4 text-left">
									<a href="{{item[urlField]}}" [attr.target]="isLinkExternal(item[urlField]) ? '_blank' : null">
										<span>
											{{item[titleField]}}
											<svg *ngIf="item.svgID" class="x24" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
												<use attr.href="{{item.svgID}}" attr.xlink:href="{{item.svgID}}"></use>
											</svg>
											<ng-container *ngIf="item[titleField + '_alt']">
												[{{item[titleField + '_alt']}}]
											</ng-container>
											<svg *ngIf="isLinkExternal(item[urlField])" class="x16" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
												<use href="#external" xlink:href="#external"></use>
											</svg>
										</span>
									</a>
								</div>
								<p *ngIf="item[descriptionField]" [innerHTML]="item[descriptionField]"></p>
								<p *ngIf="item[dateField]"><span *ngIf="!isLabelHidden(dateField)">{{dateField}}: </span>{{item[dateField] | date:dateFormat}}</p>
								<ng-container *ngFor="let field of additionalFields">
									<p *ngIf="item[field]">
										<span *ngIf="!isLabelHidden(field)">{{field}}: </span>
										{{item[field]}}
									</p>
								</ng-container>
								<ng-container *ngIf="displayFilterVals">
									<p *ngFor="let filter of filterFields"><span *ngIf="!isLabelHidden(filter)">{{filter}}: </span>
										<ng-container *ngFor="let filterVal of item[filter] | slice:0:10; let last = last">
											<a href="" (click)="doFilter(filter, filterVal)">{{formatForView( filterVal )}}</a><ng-container *ngIf="!last">, </ng-container>
										</ng-container>
									</p>
								</ng-container>
								<div *ngIf="item[altFormats]" class="mb-10">
									<span *ngIf="!isLabelHidden(altFormats)">{{altFormats}}: </span>
									<ul class="d-inline list-inline">
										<li class="list-inline-item" *ngFor="let alt of item[altFormats]">
											<a href="{{alt['Alternative File Format']}}" [attr.target]="isLinkExternal(alt['Alternative File Format']) ? '_blank' : null">{{
												alt['Link Text (optional)'] || alt['Alternative File Format']
												}}<svg *ngIf="alt.svgID" class="x16 inline-block" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
													<use attr.href="{{alt.svgID}}" attr.xlink:href="{{alt.svgID}}"></use>
												</svg><span *ngIf="alt['Alternative File Format_alt']">[{{
													alt['Alternative File Format_alt']
												}}]</span><svg *ngIf="isLinkExternal(alt['Alternative File Format'])" class="x16 inline-block" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
													<use href="#external" xlink:href="#external"></use>
												</svg>
											</a>
										</li>
									</ul>
								</div>
								<div *ngIf="item[altLanguages]" class="mb-10">
									<span *ngIf="!isLabelHidden(altLanguages)">{{altLanguages}}: </span>
									<ul class="d-inline list-inline">
										<li class="list-inline-item" *ngFor="let alt of item[altLanguages]">
											<a href="{{alt['Alternative Language']}}">{{alt['Link Text (optional)']}}</a>
										</li>
									</ul>
								</div>
								<p *ngIf="displayComments"><svg class="x24 inline-block ml-2 mr-2 fill-p" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use href="#comment3" xlink:href="#comment3"></use></svg><a href="{{item[urlField]}}#{{getCommentAnchor()}}">Comments</a></p>
							</div><!-- col -->
							<ng-container *ngIf="'right' === imagePosition">
								<div *ngIf="item[imageField]" class="{{imageColWidth}}">
									<img src="{{item[imageField]}}" alt="{{item[titleField]}}" class="img-fluid"/>
								</div>
							</ng-container>
						</div><!-- row -->
					</div><!-- card-body -->

				</div><!-- card -->
			</div><!-- column -->
		</div><!-- row -->
	</div>

  <!-- RESULTS with card position top -->
	<ng-container *ngIf="'top' === imagePosition">
		<div class="row">
			<div class="{{colWidth}}"  *ngFor="let item of currentPageData; let i = index; let odd = odd">
				<div class="card mb-3 {{bgColor}}">
					<div class="card-body">
						<div class="card">
							<img *ngIf="item[imageField] && !makeImagesLinks" src="{{item[imageField]}}" alt="{{item.hasOwnProperty( imageField + '_alt' ) ? item[imageField + '_alt'] : item[titleField]}}" class="card-img-top p-0"/>
							<a *ngIf="makeImagesLinks && item[imageField]" href="{{item[urlField]}}" [attr.target]="isLinkExternal(item[urlField]) ? '_blank' : null">
								<img src="{{item[imageField]}}" alt="{{item.hasOwnProperty( imageField + '_alt' ) ? item[imageField + '_alt'] : item[titleField]}}" class="card-img-top p-0"/>
							</a>
							<div class="card-body pr-0 pl-0">
								<div *ngIf="item[titleField]" class="card-title h4 text-left">
									<a href="{{item[urlField]}}" [attr.target]="isLinkExternal(item[urlField]) ? '_blank' : null">
										<span>
											{{item[titleField]}}
											<svg *ngIf="item.svgID" class="x24" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
												<use attr.href="{{item.svgID}}" attr.xlink:href="{{item.svgID}}"></use>
											</svg>
											<ng-container *ngIf="item[titleField + '_alt']">
												[{{item[titleField + '_alt']}}]
											</ng-container>
											<svg *ngIf="isLinkExternal(item[urlField])" class="x16" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
												<use href="#external" xlink:href="#external"></use>
											</svg>
										</span>
									</a>
								</div>
								<p *ngIf="item[descriptionField]" [innerHTML]="item[descriptionField]"></p>
								<p *ngIf="item[dateField]"><span *ngIf="!isLabelHidden(dateField)">{{dateField}}: </span>{{item[dateField] | date:dateFormat}} </p>
								<ng-container *ngFor="let field of additionalFields">
									<p *ngIf="item[field]">
										<span *ngIf="!isLabelHidden(field)">{{field}}: </span>
										{{item[field]}}
									</p>
								</ng-container>
								<ng-container *ngIf="displayFilterVals">
									<p *ngFor="let filter of filterFields"> <span *ngIf="!isLabelHidden(filter)">{{filter}}: </span>
										<ng-container *ngFor="let filterVal of item[filter] | slice:0:10; let last = last">
											<a href="" (click)="doFilter(filter, filterVal)">{{formatForView( filterVal )}}</a><ng-container *ngIf="!last">, </ng-container>
										</ng-container>
									</p>
								</ng-container>
								<div *ngIf="item[altFormats]" class="mb-10">
									<span *ngIf="!isLabelHidden(altFormats)">{{altFormats}}: </span>
									<ul class="d-inline list-inline">
										<li class="list-inline-item" *ngFor="let alt of item[altFormats]">
											<a href="{{alt['Alternative File Format']}}" [attr.target]="isLinkExternal(alt['Alternative File Format']) ? '_blank' : null">{{
												alt['Link Text (optional)'] || alt['Alternative File Format']
												}}<svg *ngIf="alt.svgID" class="x16 inline-block" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
													<use attr.href="{{alt.svgID}}" attr.xlink:href="{{alt.svgID}}"></use>
												</svg><span *ngIf="alt['Alternative File Format_alt']">[{{
													alt['Alternative File Format_alt']
												}}]</span><svg *ngIf="isLinkExternal(alt['Alternative File Format'])" class="x16 inline-block" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
													<use href="#external" xlink:href="#external"></use>
												</svg>
											</a>
										</li>
									</ul>
								</div>
								<div *ngIf="item[altLanguages]" class="mb-10">
									<span *ngIf="!isLabelHidden(altLanguages)">{{altLanguages}}: </span>
									<ul class="d-inline list-inline">
										<li class="list-inline-item" *ngFor="let alt of item[altLanguages]">
											<a href="{{alt['Alternative Language']}}">{{alt['Link Text (optional)']}}</a>
										</li>
									</ul>
								</div>
								<p *ngIf="displayComments"><svg class="x24 inline-block ml-2 mr-2 fill-p" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><use href="#comment3" xlink:href="#comment3"></use></svg><a href="{{item[urlField]}}#{{getCommentAnchor()}}">Comments</a></p>
							</div><!-- card-body -->
						</div><!-- card -->
					</div><!-- card-body -->
				</div><!-- card -->
			</div><!-- column -->
		</div><!-- row -->
	</ng-container>
	<!--<pagination-controls (pageChange)="p = $event"></pagination-controls>-->
	<ngb-pagination
			*ngIf="filteredDataLength > itemsPerPage"
		class="d-flex justify-content-center"
		(pageChange)="changeCurrentPage($event)"
		[(collectionSize)]="filteredDataLength"
		[(page)]="currentPage"
		[maxSize]="3"
		[rotate]="true"
		[ellipses]="true"
		[(directionLinks)]="directionLinks"
		[(boundaryLinks)]="boundaryLinks"
		[(pageSize)]="itemsPerPage">
    </ngb-pagination>
    <svg style="display:none" focusable="false" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <symbol id="comment3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xmlns:xlink="http://www.w3.org/1999/xlink">
            <title>comment3</title>
            <path d="M 18 8.016 v -2.016 h -12 v 2.016 h 12 Z M 18 11.016 v -2.016 h -12 v 2.016 h 12 Z M 18 14.016 v -2.016 h -12 v 2.016 h 12 Z M 21.984 3.984 v 18 l -3.984 -3.984 h -14.016 c -1.078 0 -1.969 -0.938 -1.969 -2.016 v -12 c 0 -1.078 0.891 -1.969 1.969 -1.969 h 16.031 c 1.078 0 1.969 0.891 1.969 1.969 Z" />
        </symbol>
    </svg>
</div>
